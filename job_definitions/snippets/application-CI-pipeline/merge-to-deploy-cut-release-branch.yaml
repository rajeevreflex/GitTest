---
- job-template:
    name: '{name}-merge-to-deploy-cut-release-branch'
    parameters:
      - extended-choice:
          name: release_type
          description: "Select release type"
          type: 'PT_RADIO'
          value: Major,Minor,Patch
    project-type: freestyle
    defaults: global
    description: 'Do not edit this job through the web!'
    disabled: false
    display-name: 'Rebase on develop and create release branch for {name}'
    node: '{name}'
    properties:
      - build-discarder:
          days-to-keep: 365
          num-to-keep: 100
      - delivery-pipeline:
          stage: Check
          task: Rebase on MASTER
    wrappers:
      - ansicolor
    scm:
      - '{app_code_repository_type}':
          url: '{app_code_repository_uri}'
          credentials-id: '{app_code_repository_credentials}'
          git-config-name: '{app_code_repository_display_name}'
          git-config-email: '{app_code_repository_display_email}'
          timeout: 5
    builders:
      - shell: echo "======= Rebase -- origin/master $GIT_BRANCH ======="
      - shell: echo "======= Commit -- $GIT_COMMIT ======="
      - shell: !include-raw-escape: cutrelease.sh
      - shell: echo "======= Branch -- $GIT_BRANCH ======="
    #  - shell: !include-raw-escape: tag_and_merge_release.sh
      #- shell: git rebase origin/master
    # publishers:
    #   - trigger-parameterized-builds:
    #       - project:
    #           - '{name}-{repo_language}-eslint'
    #         current-parameters: true
    #         git-revision: true
    #         condition: SUCCESS
    #         node-label: '{name}'
